(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{281:function(s,a,t){"use strict";t.r(a);var e=t(0),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("使用Docker搭建MySQL主从复制")]),s._v(" "),t("h3",{attrs:{id:"_1、下载mysql镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、下载mysql镜像"}},[s._v("#")]),s._v(" 1、下载MySQL镜像")]),s._v(" "),t("p",[s._v("我这里直接下载最新版本镜像，版本8.0")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker pull mysql\n")])])]),t("h3",{attrs:{id:"_2、创建容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建容器"}},[s._v("#")]),s._v(" 2、创建容器")]),s._v(" "),t("p",[s._v("使用"),t("code",[s._v("mysql")]),s._v("镜像创建两个容器，主从分别对应"),t("code",[s._v("33061")]),s._v("和"),t("code",[s._v("33062")]),s._v("端口")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33061")]),s._v(":3306 --name mysql-master -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxxxxxx -d mysql\ndocker run -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33062")]),s._v(":3306 --name mysql-slave -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxxxxxx -d mysql\n")])])]),t("h3",{attrs:{id:"_3、修改mysql配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、修改mysql配置文件"}},[s._v("#")]),s._v(" 3、修改MySQL配置文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看正在运行的所有容器")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分别进入主从MySQL容器")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it 146ff0765304 /bin/bash\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/mysql/conf.d/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#vim需要手动安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" mysql.cnf\n")])])]),t("p",[s._v("修改MySQL配置文件")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("主服务器配置")]),s._v(" "),t("div",{staticClass:"language-cnf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[mysqld]\n## 设置server_id\nserver-id=100\nlog-bin=mysql-bin\n")])])])]),s._v(" "),t("li",[t("p",[s._v("从服务器配置")]),s._v(" "),t("div",{staticClass:"language-cnf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[mysqld]\n## 设置server_id,注意要唯一\nserver-id=101  \n## 开启二进制日志功能，以备Slave作为其它Slave的Master时使用\nlog-bin=mysql-slave-bin   \n## relay_log配置中继日志\nrelay_log=edu-mysql-relay-bin\n")])])])])]),s._v(" "),t("h3",{attrs:{id:"_4、重启容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、重启容器"}},[s._v("#")]),s._v(" 4、重启容器")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启主从容器 我这边只写了一个")]),s._v("\ndocker restart 146ff0765304\n")])])]),t("h3",{attrs:{id:"_5、使用navicat连接数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、使用navicat连接数据库"}},[s._v("#")]),s._v(" 5、使用Navicat连接数据库")]),s._v(" "),t("ul",[t("li",[s._v("使用客户端连接主从数据库，也可直接在服务器用命令行连接")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i.loli.net/2020/03/29/4C6XYKhwUvaAceP.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[s._v("设置主数据库")]),s._v(" "),t("p",[s._v("新建查询")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 创建数据同步用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'reader'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxxxxxxx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 授予权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" CLIENT "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'reader'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("再执行"),t("code",[s._v("SHOW MASTER STATUS")]),s._v("语句查看File和Position字段，记录备用")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i.loli.net/2020/03/29/UPvS1JQpEIwYtA6.png",alt:""}})])]),s._v(" "),t("li",[t("p",[s._v("设置从数据库")]),s._v(" "),t("p",[s._v("新建查询")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 设置主节点为33061对应的数据库")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- MASTER_HOST为服务器内部IP")]),s._v("\nCHANGE MASTER "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" MASTER_HOST "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.0.229'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_USER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'reader'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_PASSWORD "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxxxxxxx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_PORT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33061")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_LOG_FILE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nMASTER_LOG_POS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("155")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 开启从节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),s._v(" SLAVE\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看从节点状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" SLAVE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v("\n")])])]),t("p",[s._v("以下两个状态为Yes即设置成功")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i.loli.net/2020/03/29/VoR2B1XkGSmlyOe.png",alt:""}})])])]),s._v(" "),t("h3",{attrs:{id:"_6、验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、验证"}},[s._v("#")]),s._v(" 6、验证")]),s._v(" "),t("ul",[t("li",[s._v("在主节点新建数据库test")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i.loli.net/2020/03/29/eICDzOpqZiN48KM.png",alt:""}})]),s._v(" "),t("ul",[t("li",[s._v("主节点成功建立数据库test")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i.loli.net/2020/03/29/9FUQZtXqdRvrcsi.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[s._v("从节点也一样建立了test库")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://i.loli.net/2020/03/29/f6OA2Zk7nMG8caN.png",alt:""}})])])])])}),[],!1,null,null,null);a.default=r.exports}}]);